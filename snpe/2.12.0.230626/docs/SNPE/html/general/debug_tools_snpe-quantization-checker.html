

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quantization Checker (Experimental) &mdash; Snapdragon Neural Processing Engine SDK</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_css.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Accuracy Debugger (Experimental)" href="debug_tools_snpe-accuracy-debugger.html" />
    <link rel="prev" title="Architecture Checker (Experimental)" href="debug_tools_snpe-architecture-checker.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Qualcomm® Neural Processing SDK
          

          
          </a>

          
            
            
              <div class="version">
                v2.12.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="revision_history.html">Revision History</a></li>
<li class="toctree-l1"><a class="reference internal" href="revision_history_windows.html">Revision History - Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup1.html">Network Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup5.html">Input Data and Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup6.html">Tutorials and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup10.html">Benchmarking and Accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="usergroup11.html">Debug Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="debug_tools_snpe-architecture-checker.html">Architecture Checker (Experimental)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Quantization Checker (Experimental)</a></li>
<li class="toctree-l2"><a class="reference internal" href="debug_tools_snpe-accuracy-debugger.html">Accuracy Debugger (Experimental)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="appx_ref.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Qualcomm® Neural Processing SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="usergroup11.html">Debug Tools</a> &raquo;</li>
        
      <li>Quantization Checker (Experimental)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quantization-checker-experimental">
<h1>Quantization Checker (Experimental)<a class="headerlink" href="#quantization-checker-experimental" title="Permalink to this headline">¶</a></h1>
<div class="ui-resizable side-nav-resizable docutils container" id="side-nav">
<div class="docutils container" id="nav-tree">
<div class="docutils container" id="nav-tree-contents">
</div>
</div>
</div>
<div class="docutils container" id="doc-content">
<div class="header docutils container">
</div>
<div class="contents docutils container">
<div class="textblock docutils container">
<p>The <strong>snpe-quantization-checker</strong> tool is used to analyze the
activations, weights and biases of all the possible
quantization options available in the snpe-converters for each
subsequent layer of a single model file or a directory of
models. The analysis involves comparing the weight, bias and
activation tensors of the quantized options to their
unquantized counterparts. The tool runs the model to generate
floating-point activations and analyzes floating-point weights,
biases and activations to determine the quality of the
encodings. It finally outputs the problematic weight, bias and
activation tensors for all quantization options.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>usage: snpe-quantization-checker [--model MODEL_PATH]
                                [--input_list INPUT_LIST_PATH]
                                [--sdk_dir SDK_DIR_PATH] (Deprecated)
                                [--activation_width ACT_BW]
                                [--bias_width BIAS_BW]
                                [--output_dir OUTPUT_DIR_PATH]
                                [--skip_building_model]
                                [--skip_generator] [--skip_runner]
                                [--generate_histogram] [--per_channel_histogram]
                                [--output_csv]
                                --config_file CONFIG_FILE_PATH

required arguments:
  --config_file - Path to the config file specifying all possible options required for execution.
                  E.g., [MODEL_PATH, _BIN, INPUT_LIST_PATH, SDK_ROOT, ACTIVATION_WIDTH, BIAS_WIDTH, OUTPUT_DIR_PATH, ANDROID_NDK_PATH, CLANG_PATH, BASH_PATH, BIN_PATH, PY3_PATH, TENSORFLOW_HOME, ONNX_HOME, QUANTIZATION_OVERRIDES, WEIGHT_COMPARISON_ALGORITHMS, BIAS_COMPARISON_ALGORITHMS, ACT_COMPARISON_ALGORITHMS, INPUT_DATA_ANALYSIS_ALGORITHMS, OUTPUT_CSV]

optional arguments:
  --model - Path to model graph file, it is required if MODEL_PATH is not set in the config_file.
  --input_list - Path to a text file containing a list of input files. It is required if the MODEL_PATH/model refers to a single model file and INPUT_LIST_PATH is not present in the config_file.
  --sdk_dir - Path to your unzipped snpe SDK, it is required if SDK_ROOT is not present in the config_file. This option will be deprecated in future releases.
  --activation_width - [Optional] Bit-width to use for activations. E.g., 8, 16. Default is 8. It can also be set using ACTIVATION_WIDTH field in the config_file.
  --bias_width - [Optional] Bit-width to use for biases. E.g., 8, 32. Default is 8. It can also be set using BIAS_WIDTH in the config_file.
  --output_dir - [Optional] Path to store the unquantized output files. It can also be set using OUTPUT_DIR_PATH in the config_file.
  --skip_building_model - [Optional] Stop the tool from building the model. It is assumed the model.so is pre-built.
  --skip_generator - [Optional] Stop the tool from running the snpe converter. It is assumed that the necessary files are already available.
  --skip_runner - [Optional] Stop the tool from running the model. It is assumed that the necessary files are already available.
  --generate_histogram - [Optional] Generate histogram analysis for weights/biases. Default is to skip histgoram generation.
  --per_channel_histogram - [Optional] Generate per channel histogram analysis for weights/biases. Default is to skip histgoram generation.
  --output_csv - [Optional] Store analysis results in csv files in the output directory.

 Please note: the arguments accepted on the command line will override those in the config file if there is overlap.
</pre></div>
</div>
<p>Here is an example of different algorithms and thresholds
mentioned in the config file:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>{
   // All other required user options can be added here

   &quot;WEIGHT_COMPARISON_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;minmax&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;maxdiff&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;sqnr&quot;, &quot;threshold&quot;:&quot;26&quot;}, {&quot;algo_name&quot;:&quot;stats&quot;, &quot;threshold&quot;:&quot;2&quot;}, {&quot;algo_name&quot;:&quot;data_range_analyzer&quot;}, {&quot;algo_name&quot;:&quot;data_distribution_analyzer&quot;, &quot;threshold&quot;:&quot;0.6&quot;}],
   &quot;BIAS_COMPARISON_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;minmax&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;maxdiff&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;sqnr&quot;, &quot;threshold&quot;:&quot;26&quot;}, {&quot;algo_name&quot;:&quot;stats&quot;, &quot;threshold&quot;:&quot;2&quot;}, {&quot;algo_name&quot;:&quot;data_range_analyzer&quot;}, {&quot;algo_name&quot;:&quot;data_distribution_analyzer&quot;, &quot;threshold&quot;:&quot;0.6&quot;}],
   &quot;ACT_COMPARISON_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;minmax&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;data_range_analyzer&quot;}]
}
</pre></div>
</div>
<p>The tool generates a <strong>html</strong> directory to include all .html
files containing clear indicators of failures and successes for
different combinations of quantization options and input files.
The tool also produces a csv directory to include all .csv
files storing detailed computation results for each metric.
Additionally, the tool generates an output log file under the
<strong>snpe-quantization-checker-log</strong> directory which contains all
log outputs.</p>
<p><strong>Sample Command</strong></p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>snpe-quantization-checker --config_file ${SDK_ROOT}/lib/python/qti/aisw/quantization_checker/configs/internal_developer_config.json
</pre></div>
</div>
<p><strong>Sample Config File</strong></p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>{
&quot;ANDROID_NDK_PATH&quot;: &quot;{Path_To_Android_NDK}/Android/android-ndk-r25c&quot;,
&quot;CLANG_PATH&quot;: &quot;{Path_To_Clang_Lib}/clang-9.0.0/bin&quot;,
&quot;PY3_PATH&quot;: &quot;/{PY3_PATH}/py3env/bin&quot;,
&quot;BASH_PATH&quot;: &quot;/bin&quot;,
&quot;BIN_PATH&quot;: &quot;/usr/bin&quot;,
&quot;TENSORFLOW_HOME&quot;: &quot;/{Path_To_Tensorflow}/bionic/py3&quot;,
&quot;TFLITE_HOME&quot;: &quot;/{Path_To_TFLITE}/bionic/py3&quot;,
&quot;ONNX_HOME&quot;: &quot;/{Path_To_Onnx}/bionic/py3&quot;,
&quot;MODEL_PATH&quot;: &quot;/{Path_To_Model}/model_frozen.pb&quot;,
&quot;INPUT_LIST_PATH&quot;: &quot;/{Path_To_Input}/input_list.txt&quot;,
&quot;WEIGHT_COMPARISON_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;minmax&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;maxdiff&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;sqnr&quot;, &quot;threshold&quot;:&quot;26&quot;}, {&quot;algo_name&quot;:&quot;stats&quot;, &quot;threshold&quot;:&quot;2&quot;}, {&quot;algo_name&quot;:&quot;data_range_analyzer&quot;}, {&quot;algo_name&quot;:&quot;data_distribution_analyzer&quot;, &quot;threshold&quot;:&quot;0.6&quot;}],
&quot;BIAS_COMPARISON_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;minmax&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;maxdiff&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;sqnr&quot;, &quot;threshold&quot;:&quot;26&quot;}, {&quot;algo_name&quot;:&quot;stats&quot;, &quot;threshold&quot;:&quot;2&quot;}, {&quot;algo_name&quot;:&quot;data_range_analyzer&quot;}, {&quot;algo_name&quot;:&quot;data_distribution_analyzer&quot;, &quot;threshold&quot;:&quot;0.6&quot;}],
&quot;ACT_COMPARISON_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;minmax&quot;, &quot;threshold&quot;:&quot;10&quot;}, {&quot;algo_name&quot;:&quot;data_range_analyzer&quot;}],
&quot;INPUT_DATA_ANALYSIS_ALGORITHMS&quot;: [{&quot;algo_name&quot;:&quot;stats&quot;, &quot;threshold&quot;:&quot;2&quot;}],
&quot;OUTPUT_CSV&quot;: &quot;True&quot;,
&quot;INPUT_DIMENSION&quot;: [&quot;&#39;input&#39; 1,299,299,3&quot;],
&quot;OUTPUT_DIR_PATH&quot;: &quot;{Path_To_Output_Dir}&quot;
}
</pre></div>
</div>
<p><strong>Viewing the results (html, csv or log files)</strong></p>
<p>All results are stored in output directories under the user
specified directory.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span># In user_specified_dir, all .html files are stored in &quot;user_specified_dir/html&quot;, .csv files are stored in &quot;user_specified_dir/csv&quot; and log files are stored in &quot;user_specified_dir/snpe-quantization-checker-log&quot;.
cd ${Path_to_the_model}/user_specified_dir/html
# This directory contains all the html files produced by the snpe-quantization-checker which can be opened with any standard web browser.
cd ${Path_to_the_model}/user_specified_dir/csv
# This directory contains all the csv files produced by the snpe-quantization-checker which can be viewed with any standard text editor or spreadsheet application such as Excel, LibreOffice, etc.
cd ${Path_to_the_model}/user_specified_dir/snpe-quantization-checker-log
# This directory contains all the log files produced by the snpe-quantization-checker. The files are time stamped and can be viewed in any text editor.
</pre></div>
</div>
<div class="line-block">
<div class="line"><strong>HTML Results Files</strong></div>
</div>
<div class="line-block">
<div class="line">Each HTML file contains a summary of the results for each
quantization option and for each input file provided.</div>
</div>
<div class="line-block">
<div class="line"><strong>Note</strong>: Snapshot of HTML content has been added for
clarity.</div>
</div>
<div class="docutils container">
<div class="figure align-default">
<img alt="../images/snpe_quantization_checker_html_sample.png" src="../images/snpe_quantization_checker_html_sample.png" />
</div>
</div>
<div class="line-block">
<div class="line"><strong>CSV Results Files</strong></div>
</div>
<p>Each CSV file contains detailed computation results for a
specific node type (activation/weight/bias) and quantization
option. Each row in the csv file displays the op name, node
name, passes accuracy (True/False), computation result
(accuracy differences), threshold being used for each algorithm
and the algorithm name. Computation results(accuracy
differences) format can be somewhat different according to
different algorithms/metrics.</p>
<p>The following are a few short notes about the different
algorithms and the information each csv row contains:</p>
<div class="line-block">
<div class="line"><strong>minmax: Indicates the difference between the unquantized
minimum and the dequantized minimum value. Correspondingly,
indicates the same difference for the maximum unquantized and
dequantized value.</strong></div>
<div class="line">Example computation result: “min: #VALUE max: #VALUE”</div>
<div class="line"><strong>maxdiff: Calculates the absolute difference between the
unquantized and dequantized data for all data points and
displays the maximum value of the result.</strong></div>
<div class="line">Example computation result: “#VALUE”</div>
<div class="line"><strong>sqnr: Calculates the signal to quantization noise ratio
between the two tensors of unquantized and dequantized
data.</strong></div>
<div class="line">Example computation result: “#VALUE”</div>
<div class="line"><strong>data_range_analyzer: Calculates the difference between the
maximum and minimum values in a tensor and compares that to
the maximum value supported by the bit-width used to
determine if the range of values can be reasonably
represented by the selected quantization bit width.</strong></div>
<div class="line">Example computation result: “unique dec places: #INT_VALUE
data range : #VALUE”. Information in the computation results
field includes how many unique decimal places we need to
express the unquantized data in quantized format and what is
the actual data range.</div>
<div class="line"><strong>data_distribution_analyzer: Calculates the clustering of
the data to find whether a large number of unique unquantized
values are quantized to the same value or not.</strong></div>
<div class="line">Example computation result: “Distribution of pixels above
threshold: #VALUE”</div>
<div class="line"><strong>stats: Calculates some basic statistics on the received
data such as the min, max, median, variance, standard
deviation, the mode and the skew. The skew is used to
indicate how symmetric the data is.</strong></div>
<div class="line">Example computation result: skew: #VALUE min: #VALUE max:
#VALUE median: #VALUE variance: #VALUE stdDev: #VALUE mode:
#VALUE</div>
</div>
<p><strong>Note</strong>: Snapshot of a CSV file content for weight data for
one of the quantization options has been added below.</p>
<div class="docutils container">
<div class="figure align-default">
<img alt="../images/snpe_quantization_checker_csv_weights.png" src="../images/snpe_quantization_checker_csv_weights.png" />
</div>
</div>
<p>Separate .csv files are available for activations, weights and
biases for each quantization option. The activation related
results also include analysis for each input file provided.</p>
<div class="line-block">
<div class="line"><strong>Log Result File</strong></div>
</div>
<p>The log files contain the following information:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>1. All the commands executed as part of the script’s run. This will include different runs of the snpe-converter tool with different quantization options
1. Activations Analysis Failures
2. Weights Analysis Failures
3. Biases Analysis Failures
</pre></div>
</div>
<p>A sample log output looks like below:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>&lt;====ACTIVATIONS ANALYSIS FAILURES====&gt;

Results for the enhanced quantization:
|         Op Name         | Activation Node | Passes Accuracy |         Accuracy Difference          | Threshold Used | Algorithm Used |
|  conv_tanh_comp1_conv0  |    ReLU_6919    |      False      | minabs_diff: 0.59 maxabs_diff: 17.16 |      0.05      |     minmax     |

where,

1. Op Name : Op Name as expressed in snpe_model.cpp
2. Activation Node : Activation Node Name in the Op
3. Passes Accuracy : Pass if the quantized activation(or weight or bias) meets threshold when compared with values from float32 graph
4. Accuracy Difference : Details about the accuracy per the algorithm used
5. Threshold Used : The threshold used to influence the result of “Passes Accuracy” column
6. Algorithm Used : Metric used to compare actual quantized activations/weights/biases against unquantized float data or analyze the quality of unquantized float data. Metrics can be minmax, maxdiff, sqnr, stats, data_range_analyzer, data_distribution_analyzer.
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="debug_tools_snpe-accuracy-debugger.html" class="btn btn-neutral float-right" title="Accuracy Debugger (Experimental)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="debug_tools_snpe-architecture-checker.html" class="btn btn-neutral float-left" title="Architecture Checker (Experimental)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2023, Qualcomm Technologies, Inc..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>